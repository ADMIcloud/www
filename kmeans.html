
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>K-Means &mdash; ADMICloud  documentation</title>
    
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ADMICloud  documentation" href="index.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">

    <p style="text-align:center;"><img src="_static/images/cover.jpg"></p>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="k-means">
<h1>K-Means<a class="headerlink" href="#k-means" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to implement the K-means algorithm using Hadoop.</p>
<a class="reference internal image-reference" href="_images/hadoopkmeans.png"><img alt="hadoop kmeans" class="align-center" src="_images/hadoopkmeans.png" style="width: 520px; height: 300px;" /></a>
<div class="section" id="understanding-k-means">
<h2>Understanding K-Means<a class="headerlink" href="#understanding-k-means" title="Permalink to this headline">¶</a></h2>
<p>K-Means is a very powerful and easily understood clustering algorithm. The aim of the algorithm is to divide a given set of points into &#8220;K&#8221; partitions. &#8220;K&#8221; needs to be specified
by the user. In order to understand K-Means, first you need to understand the proceeding concepts and their meaning.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Centroids</dt>
<dd><p class="first last">Centroids can be defined as the center of each cluster. If we are performing clustering with k=3, we will have 3 centroids. To perform K-Means clustering, the users needs to
provide the initial set of centroids.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Distance</dt>
<dd><p class="first last">In order to group data points as close together or as far-apart we need to define a distance between two given data points. In K-Means clustering distance is normally calculated as the Euclidean
Distance between two data points.</p>
</dd>
</dl>
</li>
</ol>
<p>The K-Means algorithm simply repeats the following set of steps until there is no change in the partition assignments, in that it has clarified which data point is
assigned to which partition.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Choose K points as the initial set of centroids.</li>
<li>Assign each data point in the data set to the closest centroid (this is done by calculating the distance between the data point and each centroid).</li>
<li>Calculate the new centroids based on the clusters that were generated in step 2. Normally this is done by calculating the mean of each cluster.</li>
<li>Repeat steps 2 and 3 until data points do not change cluster assignments, meaning their centroids are set.</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="pseudo-code-and-java-code">
<h2>Pseudo Code and Java Code<a class="headerlink" href="#pseudo-code-and-java-code" title="Permalink to this headline">¶</a></h2>
<p>Denote:</p>
<ul class="simple">
<li>N is the number of data points</li>
<li>M is the number of centroids</li>
<li>D is the dimension of centroids</li>
<li>Vi refers to the ith data point(vector)</li>
<li>Cj refers to the jth centroid</li>
</ul>
<div class="section" id="the-main-method">
<h3>The Main Method<a class="headerlink" href="#the-main-method" title="Permalink to this headline">¶</a></h3>
<p>The tasks of the main class is to configure and run the job iteratively.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">generate</span> <span class="n">N</span> <span class="n">data</span> <span class="nf">points</span> <span class="o">(</span><span class="n">D</span> <span class="n">dimensions</span><span class="o">),</span> <span class="n">write</span> <span class="n">to</span> <span class="n">HDFS</span>
<span class="n">generate</span> <span class="n">M</span> <span class="n">centroids</span><span class="o">,</span> <span class="n">write</span> <span class="n">to</span> <span class="n">HDFS</span>
<span class="k">for</span> <span class="n">iterations</span><span class="o">{</span>
    <span class="n">configure</span> <span class="n">a</span> <span class="n">job</span>
    <span class="n">launch</span> <span class="n">the</span> <span class="n">job</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now looking at the actual java implementation. The first step of the sample program is to generate a set of points. This is done using the following line in the main launch method. The actual method
that is in the Utils.java class is also shown for reference. This method generates a set of data points and writes them into the folder specified. The method also takes in parameters to specify the number
of files and number of data points that need to be generated. The data points are divided among the data files.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Utils</span><span class="o">.</span><span class="na">generateDataFiles</span><span class="o">(</span><span class="n">fs</span><span class="o">,</span> <span class="n">dataDir</span><span class="o">,</span>  <span class="n">numDataPoints</span><span class="o">,</span> <span class="n">vectorSize</span><span class="o">,</span> <span class="n">numFiles</span> <span class="o">);</span>

<span class="c1">// generateDataFiles method from Utils.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">generateDataFiles</span><span class="o">(</span><span class="n">FileSystem</span> <span class="n">fs</span><span class="o">,</span> <span class="n">Path</span> <span class="n">dataDir</span><span class="o">,</span> <span class="kt">int</span> <span class="n">numOfDataPoints</span><span class="o">,</span> <span class="kt">int</span> <span class="n">vectorSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">numFiles</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
            <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">dataPerFile</span> <span class="o">=</span> <span class="n">numOfDataPoints</span> <span class="o">/</span> <span class="n">numFiles</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">numOfDataPoints</span> <span class="o">%</span> <span class="n">numFiles</span><span class="o">;</span>
            <span class="n">BufferedWriter</span> <span class="n">br</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">Path</span> <span class="n">pt</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">dataThisFile</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numFiles</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">remainder</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
                            <span class="n">dataThisFile</span> <span class="o">=</span> <span class="n">dataPerFile</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
                            <span class="n">remainder</span> <span class="o">-=</span> <span class="mi">1</span><span class="o">;</span>
                    <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                            <span class="n">dataThisFile</span> <span class="o">=</span> <span class="n">dataPerFile</span><span class="o">;</span>
                    <span class="o">}</span>

                    <span class="n">pt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Path</span><span class="o">(</span><span class="n">KmeansConstants</span><span class="o">.</span><span class="na">DATA_DIR</span> <span class="o">+</span> <span class="s">&quot;/data_&quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
                    <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">fs</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">pt</span><span class="o">,</span><span class="kc">true</span><span class="o">)));</span>
                    <span class="n">String</span> <span class="n">aData</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">;</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">dataThisFile</span><span class="o">;</span> <span class="n">k</span><span class="o">++){</span>
                            <span class="n">aData</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
                            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">vectorSize</span><span class="o">;</span> <span class="n">j</span><span class="o">++){</span>
                                    <span class="kt">int</span> <span class="n">aElement</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
                                    <span class="k">if</span><span class="o">(</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">vectorSize</span><span class="o">-</span><span class="mi">1</span> <span class="o">){</span>
                                            <span class="n">aData</span> <span class="o">+=</span> <span class="n">aElement</span> <span class="o">+</span> <span class="s">&quot;\t&quot;</span><span class="o">;</span>
                                    <span class="o">}</span>
                                    <span class="k">else</span><span class="o">{</span>
                                            <span class="n">aData</span> <span class="o">+=</span> <span class="n">aElement</span><span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
                                    <span class="o">}</span>
                            <span class="o">}</span>
                            <span class="n">br</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">aData</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;wrote to &quot;</span><span class="o">+</span><span class="n">pt</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="o">}</span>
    <span class="o">}</span>
</pre></div>
</div>
<p>The next step is to generate a set of centroids. As it was mentioned in the description K-Means needs a set of initial centroids. The &#8220;generateInitialCentroids&#8221; method in the Utils class
will generate a set of random centroids.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Utils</span><span class="o">.</span><span class="na">generateInitialCentroids</span><span class="o">(</span><span class="n">fs</span><span class="o">,</span> <span class="n">cDir</span><span class="o">,</span> <span class="n">numCentroids</span><span class="o">,</span> <span class="n">vectorSize</span><span class="o">);</span>
</pre></div>
</div>
<p>After the initialization steps are completed the main class will run a set of map reduce jobs iteratively. The number of iterations are specified by the user.
The following code block will at each iteration configure a job and run it.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">iter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">iter</span> <span class="o">&lt;</span> <span class="n">numIteration</span><span class="o">;</span> <span class="n">iter</span><span class="o">++){</span>
    <span class="c1">//delete output directory if existed</span>
    <span class="k">if</span><span class="o">(</span> <span class="n">fs</span><span class="o">.</span><span class="na">exists</span><span class="o">(</span><span class="n">outDir</span><span class="o">)){</span>
        <span class="n">fs</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">outDir</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">job</span> <span class="o">=</span> <span class="n">configureAJob</span><span class="o">(</span><span class="n">configuration</span><span class="o">,</span> <span class="n">iter</span><span class="o">,</span> <span class="n">vectorSize</span><span class="o">,</span> <span class="n">numCentroids</span><span class="o">,</span><span class="n">dataDir</span><span class="o">,</span> <span class="n">outDir</span> <span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">job</span><span class="o">.</span><span class="na">waitForCompletion</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;---------------------------| Iteration #&quot;</span> <span class="o">+</span><span class="n">iter</span> <span class="o">+</span> <span class="s">&quot; Finished |-------------------------------&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="the-mapper">
<h3>The Mapper<a class="headerlink" href="#the-mapper" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span></span>load centroids

#The value of the input key-value pair is a data point Vi
find the nearest centroid Cj for the data point Vi
Context.write(j, &lt;Vi, 1&gt;)
</pre></div>
</div>
<p>Now looking at the java implementaion of the mapper class. First the setup method will be called to initialize the mapper class. In the setup method
all the needed configurations will be loaded. most importantly the set of centroids that are saved in the centroids file will be loaded into an array.
The main map task is handled in the map function.</p>
<p>In the map function it reads in each line from the data files and calculates distances between the current data point and each centroid to determine the closest centroid
to the data point. The index of the closest centroid is stored in the variable &#8220;minCentroid&#8221; for later use. The values in the &#8220;newCentroids&#8221; array is updated after finding the closest
centroid. &#8220;newCentroids&#8221; array contains the sum of all data points that are closest to each centroid. For example newCentroids[0] contains the sum of all data points that are closest to
centroid 0.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">map</span><span class="o">(</span><span class="n">LongWritable</span> <span class="n">key</span><span class="o">,</span> <span class="n">Text</span> <span class="n">val</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>

            <span class="c1">//1.2 construct the input data point</span>
            <span class="n">String</span> <span class="n">valStr</span><span class="o">[]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;\t&quot;</span><span class="o">);</span>
            <span class="kt">double</span> <span class="n">data</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[</span><span class="n">VECTOR_SIZE</span><span class="o">];</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">VECTOR_SIZE</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="n">data</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">valStr</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>

            <span class="c1">//1.3 find nearest centroid for the input data point.</span>
            <span class="kt">double</span> <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">minCentroid</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="kt">double</span> <span class="n">minDistance</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_CENTROIDS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="na">getEuclidean2</span><span class="o">(</span><span class="n">centroids</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">data</span><span class="o">,</span> <span class="n">VECTOR_SIZE</span><span class="o">);</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
                            <span class="n">minDistance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">;</span>
                            <span class="n">minCentroid</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">minDistance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">;</span>
                            <span class="n">minCentroid</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
                    <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">VECTOR_SIZE</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                    <span class="n">newCentroids</span><span class="o">[</span><span class="n">minCentroid</span><span class="o">][</span><span class="n">i</span><span class="o">]</span> <span class="o">+=</span> <span class="n">data</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="n">cCounts</span><span class="o">[</span><span class="n">minCentroid</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>
</div>
<p>After the map task is completed the cleanup function will write the output of the map task which will be sent to the reduce tasks. the following code segment in the cleanup method
will iterate over all the centroids and write a key value pair where the key is the id of the centroid and  value is the sum of data assigned to this centroid, and the count of these data points.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_CENTROIDS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">context</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="k">new</span> <span class="n">IntWritable</span><span class="o">(</span><span class="n">i</span><span class="o">),</span> <span class="k">new</span> <span class="n">CentroidCountWritable</span><span class="o">(</span><span class="n">newCentroids</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">VECTOR_SIZE</span><span class="o">,</span> <span class="n">cCounts</span><span class="o">[</span><span class="n">i</span><span class="o">]));</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="the-reducer">
<h3>The Reducer<a class="headerlink" href="#the-reducer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span></span>#The key is an ID of a centroid, the value list is a list of &lt;Vi, 1&gt;
newCentroid = a new D dimensional vector
count = 0
for each pair &lt;Vi, 1&gt; in the value list{
    for k in 0 to (D-1) {
        newCentroid[k] += Vi[k]
    }
    count += 1
}

for k in 0 to (D-1) {
        newCentroid[k] /= count
}

output newCentroid to HDFS
</pre></div>
</div>
<p>In the java implementation of the reducer class similar to the mapper class the setup method will perform the basic initialization functions of the class. after the setup is done the
main reducer tasks will be handled in the reduce method.</p>
<p>The reduce task will receive a key value pair which was outputted from the map functions. where the key is the id of the centroid and  value is the sum of data assigned to this centroid, and the count of these data points.
during the reduce phase all the key value pairs with the same key will be merged to calculate the sum of all the data points that are assigned to each centroid and to calculate
the total number of data points assigned to each centroid</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>public void reduce<span class="o">(</span>IntWritable key, Iterable&lt;CentroidCountWritable&gt; values, Context context<span class="o">)</span>
                    throws IOException, InterruptedException <span class="o">{</span>
            //1.1 reduce centroids
            int <span class="nv">index</span> <span class="o">=</span> key.get<span class="o">()</span><span class="p">;</span>
            <span class="k">for</span> <span class="o">(</span>CentroidCountWritable value : values<span class="o">)</span> <span class="o">{</span>
                    double<span class="o">[]</span> <span class="nv">strData</span> <span class="o">=</span> value.getValueArrary<span class="o">()</span><span class="p">;</span>
                    <span class="k">for</span> <span class="o">(</span>int <span class="nv">i</span> <span class="o">=</span> 0<span class="p">;</span> i &lt; VECTOR_SIZE<span class="p">;</span> i++<span class="o">)</span>
                            newCentroids<span class="o">[</span>index<span class="o">][</span>i<span class="o">]</span> +<span class="o">=</span> strData<span class="o">[</span>i<span class="o">]</span><span class="p">;</span>
                    cCounts<span class="o">[</span>index<span class="o">]</span> +<span class="o">=</span> value.getcCount<span class="o">()</span><span class="p">;</span>
            <span class="o">}</span>
    <span class="o">}</span>
</pre></div>
</div>
<p>After the reducer is completed the cleanup method will compute the new centroids  using the sum of data points in each centroid and count of data points in each
centroid ( these values are calculated in the reduce phase ). And then it will write the newly calculated centroid values to the centroid file.</p>
<p>In the next iteration these newly created centroids will be read in by the map task when performing calculations.</p>
</div>
</div>
<div class="section" id="compile-the-code">
<h2>Compile the Code<a class="headerlink" href="#compile-the-code" title="Permalink to this headline">¶</a></h2>
<p>The code is available at <a class="reference external" href="https://github.com/ADMIcloud/examples">https://github.com/ADMIcloud/examples</a>. Download the code by using the git clone command or by clicking the Download Zip button. Then go to the hadoop-kmeans directory and compile the code.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone https://github.com/ADMIcloud/examples.git
<span class="nb">cd</span> examples/hadoop-kmeans
mvn clean install
</pre></div>
</div>
</div>
<div class="section" id="run-the-code">
<h2>Run the Code<a class="headerlink" href="#run-the-code" title="Permalink to this headline">¶</a></h2>
<p>The usage is:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$HADOOP_PREFIX</span>/bin/hadoop jar target/hadoop-kmeans-1.0.jar admicloud.hadoop.kmeans.KmeansMain &lt;num Of Data Points&gt; &lt;size of a vector&gt; &lt;num of Centroids&gt; &lt;number of map tasks&gt; &lt;number of iterations&gt;
</pre></div>
</div>
<p>For example</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$HADOOP_PREFIX</span>/bin/hadoop jar target/hadoop-kmeans-1.0.jar admicloud.hadoop.kmeans.KmeansMain <span class="m">100</span> <span class="m">3</span> <span class="m">10</span> <span class="m">2</span> 3
</pre></div>
</div>
<p>Hadoop K-means wil firstly generate 100 data points, each a 3-D vector. The data will be saved to HDFS. It then generates 10 initial centroids and writes them to HDFS. For every iteration, K-means loads centroids and reads key-value pairs to do computation, then writes new centroids back to HDFS.</p>
</div>
<div class="section" id="view-the-results">
<h2>View the Results<a class="headerlink" href="#view-the-results" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$HADOOP_PREFIX</span>/bin/hdfs dfs -ls -R kmeans
kmeans/centroids
kmeans/centroids/centroids_0
kmeans/centroids/centroids_1
kmeans/centroids/centroids_2
kmeans/centroids/centroids_3
kmeans/data
kmeans/data/data_0
kmeans/data/data_1
kmeans/out
kmeans/out/_SUCCESS
kmeans/out/part-r-00000
</pre></div>
</div>
<p>In this example, data_0 and data_1 are data files. The data in file centroids_0 is the initial centroids. The data in file centroids_3 is the final result after 3 iterations.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><ul class="globaltoc"
><ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Cloud Computing Workshop</a></li>
<li class="toctree-l1"><a class="reference internal" href="schedule.html">Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="members.html">Members</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
</ul>

</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">ADMICloud  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, DSC.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>